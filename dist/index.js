var b=class extends AudioContext{constructor(){super({sampleRate:36e3})}receiveAudio(a){let t=this.createBuffer(2,2048,36e3);for(let v=0;v<2048;v++)t.getChannelData(0)[v]=a[v],t.getChannelData(1)[v]=a[v+2048];let l=this.createBufferSource();l.buffer=t,l.connect(this.destination),l.start()}};async function st(m={}){var a,t=m,l=!0,v=!1,U=[],d="./this.program",S=import.meta.url,W="";function re(e){return t.locateFile?t.locateFile(e,W):W+e}var F,B;if(l||v){try{W=new URL(".",S).href}catch{}F=async e=>{var r=await fetch(e,{credentials:"same-origin"});if(r.ok)return r.arrayBuffer();throw new Error(r.status+" : "+r.url)}}var s=console.log.bind(console),p=console.error.bind(console),R,T=!1,C,D,M,L,w,ne,ae,ie,P,oe,se,ue,fe,x=!1;function z(){var e=M.buffer;t.HEAP8=L=new Int8Array(e),t.HEAP16=ne=new Int16Array(e),t.HEAPU8=w=new Uint8Array(e),t.HEAPU16=ae=new Uint16Array(e),t.HEAP32=ie=new Int32Array(e),t.HEAPU32=P=new Uint32Array(e),t.HEAPF32=oe=new Float32Array(e),t.HEAPF64=se=new Float64Array(e),ue=new BigInt64Array(e),fe=new BigUint64Array(e)}function ce(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)Re(t.preRun.shift());K(N)}function le(){x=!0,_.e()}function ve(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)Se(t.postRun.shift());K(q)}function me(e){t.onAbort?.(e),e="Aborted("+e+")",p(e),T=!0,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw D?.(r),r}var I;function he(){return t.locateFile?re("snes9x_2005.wasm"):new URL("snes9x_2005.wasm",import.meta.url).href}function Ae(e){if(e==I&&R)return new Uint8Array(R);if(B)return B(e);throw"both async and sync fetching of the wasm failed"}async function ye(e){if(!R)try{var r=await F(e);return new Uint8Array(r)}catch{}return Ae(e)}async function ge(e,r){try{var n=await ye(e),i=await WebAssembly.instantiate(n,r);return i}catch(f){p(`failed to asynchronously prepare wasm: ${f}`),me(f)}}async function pe(e,r,n){if(!e)try{var i=fetch(r,{credentials:"same-origin"}),f=await WebAssembly.instantiateStreaming(i,n);return f}catch(u){p(`wasm streaming compile failed: ${u}`),p("falling back to ArrayBuffer instantiation")}return ge(r,n)}function _e(){return{a:at}}async function de(){function e(u,o){return _=u.exports,M=_.d,z(),nt(_),_}function r(u){return e(u.instance)}var n=_e();if(t.instantiateWasm)return new Promise((u,o)=>{t.instantiateWasm(n,(c,A)=>{u(e(c,A))})});I??=he();var i=await pe(R,I,n),f=r(i);return f}class ht{name="ExitStatus";constructor(r){this.message=`Program terminated with exit(${r})`,this.status=r}}var K=e=>{for(;e.length>0;)e.shift()(t)},q=[],Se=e=>q.push(e),N=[],Re=e=>N.push(e),we=!0,Ee=e=>Y(e),Me=()=>G(),Pe=()=>Date.now(),be=()=>2147483648,Ue=(e,r)=>Math.ceil(e/r)*r,We=e=>{var r=M.buffer.byteLength,n=(e-r+65535)/65536|0;try{return M.grow(n),z(),1}catch{}},Ie=e=>{var r=w.length;e>>>=0;var n=be();if(e>n)return!1;for(var i=1;i<=4;i*=2){var f=r*(1+.2/i);f=Math.min(f,e+100663296);var u=Math.min(n,Ue(Math.max(e,f),65536)),o=We(u);if(o)return!0}return!1},He=[null,[],[]],V=typeof TextDecoder<"u"?new TextDecoder:void 0,ke=(e,r,n,i)=>{var f=r+n;if(i)return f;for(;e[r]&&!(r>=f);)++r;return r},$=(e,r=0,n,i)=>{var f=ke(e,r,n,i);if(f-r>16&&e.buffer&&V)return V.decode(e.subarray(r,f));for(var u="";r<f;){var o=e[r++];if(!(o&128)){u+=String.fromCharCode(o);continue}var c=e[r++]&63;if((o&224)==192){u+=String.fromCharCode((o&31)<<6|c);continue}var A=e[r++]&63;if((o&240)==224?o=(o&15)<<12|c<<6|A:o=(o&7)<<18|c<<12|A<<6|e[r++]&63,o<65536)u+=String.fromCharCode(o);else{var y=o-65536;u+=String.fromCharCode(55296|y>>10,56320|y&1023)}}return u},Fe=(e,r)=>{var n=He[e];r===0||r===10?((e===1?s:p)($(n)),n.length=0):n.push(r)},Be=(e,r,n)=>e?$(w,e,r,n):"",Te=(e,r,n,i)=>{for(var f=0,u=0;u<n;u++){var o=P[r>>2],c=P[r+4>>2];r+=8;for(var A=0;A<c;A++)Fe(e,w[o+A]);f+=c}return P[i>>2]=f,0},J=e=>{var r=t["_"+e];return r},Ce=(e,r)=>{L.set(e,r)},De=e=>{for(var r=0,n=0;n<e.length;++n){var i=e.charCodeAt(n);i<=127?r++:i<=2047?r+=2:i>=55296&&i<=57343?(r+=4,++n):r+=3}return r},Le=(e,r,n,i)=>{if(!(i>0))return 0;for(var f=n,u=n+i-1,o=0;o<e.length;++o){var c=e.codePointAt(o);if(c<=127){if(n>=u)break;r[n++]=c}else if(c<=2047){if(n+1>=u)break;r[n++]=192|c>>6,r[n++]=128|c&63}else if(c<=65535){if(n+2>=u)break;r[n++]=224|c>>12,r[n++]=128|c>>6&63,r[n++]=128|c&63}else{if(n+3>=u)break;r[n++]=240|c>>18,r[n++]=128|c>>12&63,r[n++]=128|c>>6&63,r[n++]=128|c&63,o++}}return r[n]=0,n-f},xe=(e,r,n)=>Le(e,w,r,n),X=e=>j(e),ze=e=>{var r=De(e)+1,n=X(r);return xe(e,n,r),n},Ke=(e,r,n,i,f)=>{var u={string:h=>{var E=0;return h!=null&&h!==0&&(E=ze(h)),E},array:h=>{var E=X(h.length);return Ce(h,E),E}};function o(h){return r==="string"?Be(h):r==="boolean"?!!h:h}var c=J(e),A=[],y=0;if(i)for(var g=0;g<i.length;g++){var Z=u[n[g]];Z?(y===0&&(y=Me()),A[g]=Z(i[g])):A[g]=i[g]}var H=c(...A);function ot(h){return y!==0&&Ee(y),o(h)}return H=ot(H),H},qe=(e,r,n,i)=>{var f=!n||n.every(o=>o==="number"||o==="boolean"),u=r!=="string";return u&&f&&!i?J(e):(...o)=>Ke(e,r,n,o,i)};if(t.noExitRuntime&&(we=t.noExitRuntime),t.print&&(s=t.print),t.printErr&&(p=t.printErr),t.wasmBinary&&(R=t.wasmBinary),t.arguments&&(U=t.arguments),t.thisProgram&&(d=t.thisProgram),t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.shift()();t.cwrap=qe;var Ne,Ve,$e,Je,Xe,Ye,je,Ge,Ze,Qe,Oe,et,tt,rt,Y,j,G;function nt(e){t._setJoypadInput=Ne=e.f,t._my_malloc=Ve=e.g,t._my_free=$e=e.h,t._startWithRom=Je=e.i,t._mainLoop=Xe=e.j,t._getScreenBuffer=Ye=e.k,t._getSoundBuffer=je=e.l,t._saveSramRequest=Ge=e.m,t._getSaveSramSize=Ze=e.n,t._getSaveSram=Qe=e.o,t._loadSram=Oe=e.p,t._getStateSaveSize=et=e.q,t._saveState=tt=e.r,t._loadState=rt=e.s,Y=e.t,j=e.u,G=e.v}var at={c:Pe,b:Ie,a:Te};function it(){ce();function e(){t.calledRun=!0,!T&&(le(),C?.(t),t.onRuntimeInitialized?.(),ve())}t.setStatus?(t.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>t.setStatus(""),1),e()},1)):e()}var _;return _=await de(),it(),x?a=t:a=new Promise((e,r)=>{C=e,D=r}),a}var Q=st;var O=36e3,ee=917504,ut=512,ft=448,ct={wasmPath:"snes9x_2005.wasm",audioOn:!0},k=class m{cvs;ctx;WASM;emulationRunning=!0;audioNode;audioOn=!0;keyInput=0;setUint8ArrayToCMemory(a){var t=this.WASM._my_malloc(a.length);return this.WASM.HEAP8.set(a,t),t}static async create(a,t,l){let{wasmPath:v,audioOn:U}={...ct,...l};try{let d=await Q({locateFile(){return v.startsWith("http")?v:new URL(v,import.meta.url).href}}),S=new m(t,d);return S.audioOn=U,S.initEmulation(a),S}catch(d){throw new Error(`Snes9x_2005-WASM:: Initialization error.
 ${d}`)}}constructor(a,t){this.cvs=a,this.WASM=t,this.initCanvas(),this.audioNode=new b;let l=a.getContext("2d");if(!l)throw new Error("Snes9x_2005-WASM:: Invalid canvas element, unable to get rendering context.");this.ctx=l}initEmulation(a){let t=this.setUint8ArrayToCMemory(a);this.WASM._startWithRom(t,a.length,O),this.WASM._my_free(t),this.requestNextFrame()}initCanvas(){this.cvs.width=256,this.cvs.height=224}requestNextFrame(){this.WASM._setJoypadInput(this.keyInput),this.WASM._mainLoop();var a=this.WASM._getScreenBuffer(),t=new Uint8Array(this.WASM.HEAP8.buffer,a,ee);if(this.paintNewFrame(t),this.audioOn){let l=new Float32Array(this.WASM.HEAPF32.buffer,this.WASM._getSoundBuffer(),4096);this.audioNode.receiveAudio(l)}this.emulationRunning&&requestAnimationFrame(()=>this.requestNextFrame())}pauseEmulation(){this.emulationRunning=!1}startEmulation(){this.emulationRunning=!0,this.requestNextFrame()}toggleEmulationRun(){this.emulationRunning?this.pauseEmulation():this.startEmulation()}paintNewFrame(a){let t=new ImageData(ut,ft);for(var l=0;l<ee;l++)t.data[l]=a[l];this.ctx.putImageData(t,0,0,0,0,this.cvs.width,this.cvs.height)}saveState(){var a=this.WASM._getStateSaveSize(),t=this.WASM._saveState();if(t!=0){var l=new Uint8Array(new Uint8Array(this.WASM.HEAP8.buffer,t,a));return this.WASM._my_free(t),l}}loadState(a){var t=this.setUint8ArrayToCMemory(a);this.WASM._loadState(t,a.length),this.WASM._my_free(t)}loadRom(a){var t=this.setUint8ArrayToCMemory(a);this.WASM._startWithRom(t,a.length,O),this.WASM._my_free(t)}};var te=(s=>(s[s.A=128]="A",s[s.B=32768]="B",s[s.X=64]="X",s[s.Y=16384]="Y",s[s.SELECT=8192]="SELECT",s[s.START=4096]="START",s[s.L=32]="L",s[s.R=16]="R",s[s.RIGHT=256]="RIGHT",s[s.LEFT=512]="LEFT",s[s.DOWN=1024]="DOWN",s[s.UP=2048]="UP",s))(te||{}),lt={ArrowDown:1024,ArrowUp:2048,ArrowLeft:512,ArrowRight:256,a:128,b:32768,x:64,y:16384,o:4096,p:8192,l:32,r:16};function vt(m,a=lt){return{keydown:t=>{let l=t.key,v=a[l];v&&(m.keyInput=m.keyInput|v)},keyup:t=>{let l=t.key,v=a[l];v&&(m.keyInput=m.keyInput&(4294967295^v))}}}function mt(m){return(a,t=!0)=>{t?m.keyInput=m.keyInput|a:m.keyInput=m.keyInput&(4294967295^a)}}export{k as Emulator,te as SNES_CONTROL,mt as createInputHandle,vt as createKeyboardHandles};
